<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StakeOut AI Language Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            color: #333;
            margin-top: 0;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .language-selector {
            margin: 20px 0;
        }
        
        .language-selector select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 14px;
        }
        
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .console-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .current-lang {
            display: inline-block;
            padding: 4px 8px;
            background: #007bff;
            color: white;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .translation-demo {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .translation-demo h3 {
            margin-top: 0;
        }
        
        .translation-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        
        .responsive-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üåç StakeOut AI Language Integration Test</h1>
        <p>Test all alternative language setting methods</p>
        <div class="language-selector">
            <label for="languageSelect">Select Language: </label>
            <select id="languageSelect">
                <option value="en">English</option>
                <option value="es">Espa√±ol</option>
                <option value="fr">Fran√ßais</option>
                <option value="de">Deutsch</option>
                <option value="it">Italiano</option>
                <option value="pt">Portugu√™s</option>
                <option value="nl">Nederlands</option>
                <option value="da">Dansk</option>
                <option value="sv">Svenska</option>
                <option value="no">Norsk</option>
            </select>
        </div>
        <div>
            Current Language: <span id="currentLanguage" class="current-lang">Loading...</span>
        </div>
    </div>
    
    <div class="responsive-grid">
        <div class="test-section">
            <h2>üéØ Quick Actions</h2>
            <div class="controls">
                <button class="btn btn-primary" onclick="runAllTests()">Run All Tests</button>
                <button class="btn btn-success" onclick="setLanguageSelected()">Set Selected Language</button>
                <button class="btn btn-warning" onclick="getCurrentLanguageInfo()">Get Language Info</button>
                <button class="btn btn-danger" onclick="clearOutput()">Clear Output</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üîß Individual Tests</h2>
            <div class="controls">
                <button class="btn btn-primary" onclick="testStakeOutAIControls()">StakeOutAI Controls</button>
                <button class="btn btn-primary" onclick="testLanguageBridge()">Language Bridge</button>
                <button class="btn btn-primary" onclick="testLanguageManager()">Language Manager</button>
                <button class="btn btn-primary" onclick="testEnhancedUIBridge()">Enhanced UIBridge</button>
                <button class="btn btn-primary" onclick="testAndroidIntegration()">Android Integration</button>
                <button class="btn btn-primary" onclick="testGlobalMethods()">Global Methods</button>
                <button class="btn btn-primary" onclick="testDirectAppI18n()">Direct App.I18n</button>
                <button class="btn btn-primary" onclick="testTranslationSystem()">Translation System</button>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>üìñ Translation Demo</h2>
        <div class="translation-demo">
            <h3>Current Translations:</h3>
            <div id="translationDemo">
                <div class="translation-item">
                    <strong>stakeout.zoom_in:</strong> <span id="trans_zoom_in">Loading...</span>
                </div>
                <div class="translation-item">
                    <strong>stakeout.zoom_out:</strong> <span id="trans_zoom_out">Loading...</span>
                </div>
                <div class="translation-item">
                    <strong>stakeout.auto_zoom:</strong> <span id="trans_auto_zoom">Loading...</span>
                </div>
            </div>
            <button class="btn btn-success" onclick="updateTranslationDemo()">Update Translations</button>
        </div>
    </div>
    
    <div class="test-section">
        <h2>üìä System Status</h2>
        <div id="systemStatus" class="status info">Loading system status...</div>
        <button class="btn btn-warning" onclick="updateSystemStatus()">Refresh Status</button>
    </div>
    
    <div class="test-section">
        <h2>üñ•Ô∏è Console Output</h2>
        <div id="consoleOutput" class="console-output">Console output will appear here...</div>
    </div>
    
    <!-- Mock App object for testing -->
    <script>
        // Mock App object if it doesn't exist
        if (typeof App === 'undefined') {
            window.App = {
                I18n: {
                    locale: 'en',
                    setLocale: function(locale) {
                        this.locale = locale;
                        console.log('Mock App.I18n.setLocale called:', locale);
                    },
                    t: function(key) {
                        const translations = {
                            'stakeout.zoom_in': {
                                'en': 'Zoom In',
                                'es': 'Acercar',
                                'fr': 'Zoom avant',
                                'de': 'Vergr√∂√üern'
                            },
                            'stakeout.zoom_out': {
                                'en': 'Zoom Out',
                                'es': 'Alejar',
                                'fr': 'Zoom arri√®re',
                                'de': 'Verkleinern'
                            },
                            'stakeout.auto_zoom': {
                                'en': 'Auto Zoom',
                                'es': 'Zoom Autom√°tico',
                                'fr': 'Zoom automatique',
                                'de': 'Automatischer Zoom'
                            }
                        };
                        
                        const keyTranslations = translations[key];
                        if (keyTranslations) {
                            return keyTranslations[this.locale] || keyTranslations.en || key;
                        }
                        return key;
                    }
                }
            };
        }
        
        // Mock UIBridge if it doesn't exist
        if (typeof UIBridge === 'undefined') {
            window.UIBridge = {
                setLanguage: function(language) {
                    console.log('Mock UIBridge.setLanguage called:', language);
                },
                getLanguage: function() {
                    return App.I18n.locale;
                }
            };
        }
    </script>
    
    <!-- Load StakeOut AI system -->
    <script src="utils/user-preferences.js"></script>
    <script src="utils/language-manager.js"></script>
    <script src="utils/language-integration.js"></script>
    <script src="utils/language-bridge.js"></script>
    <script src="utils/battery-manager.js"></script>
    <script src="core/autozoom-engine.js"></script>
    <script src="core/ml-coordinator.js"></script>
    <script src="core/performance-monitor.js"></script>
    <script src="utils/webgl-optimizer.js"></script>
    <script src="utils/ar-enhancements.js"></script>
    <script src="core/StakeOutUIEnhanced.js"></script>
    <script src="language-test.js"></script>
    
    <script>
        // Console output capture
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;
        
        function appendToConsole(message, type = 'log') {
            const consoleOutput = document.getElementById('consoleOutput');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'warn' ? '‚ö†Ô∏è' : 'üìù';
            consoleOutput.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            appendToConsole(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalConsoleWarn.apply(console, args);
            appendToConsole(args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            appendToConsole(args.join(' '), 'error');
        };
        
        // Interface functions
        function getSelectedLanguage() {
            return document.getElementById('languageSelect').value;
        }
        
        function setLanguageSelected() {
            const language = getSelectedLanguage();
            console.log('Setting language to:', language);
            
            // Try all available methods
            const methods = [
                () => window.StakeOutAI && StakeOutAI.setLanguage(language),
                () => window.LanguageBridge && window.LanguageBridge.setLanguage(language),
                () => window.LanguageManager && window.LanguageManager.setLanguageManually(language),
                () => UIBridge.setLanguage && UIBridge.setLanguage(language),
                () => App.I18n.setLocale && App.I18n.setLocale(language)
            ];
            
            let success = false;
            for (let i = 0; i < methods.length; i++) {
                try {
                    if (methods[i]()) {
                        console.log(`Language set successfully using method ${i + 1}`);
                        success = true;
                        break;
                    }
                } catch (error) {
                    console.warn(`Method ${i + 1} failed:`, error.message);
                }
            }
            
            if (!success) {
                console.error('All language setting methods failed');
            }
            
            // Update UI
            setTimeout(() => {
                updateCurrentLanguage();
                updateTranslationDemo();
                updateSystemStatus();
            }, 100);
        }
        
        function getCurrentLanguageInfo() {
            const sources = [
                () => window.StakeOutAI && StakeOutAI.getCurrentLanguage(),
                () => window.LanguageBridge && window.LanguageBridge.getCurrentLanguage(),
                () => window.LanguageManager && window.LanguageManager.getCurrentLanguage(),
                () => UIBridge.getLanguage && UIBridge.getLanguage(),
                () => App.I18n.locale
            ];
            
            console.log('Current language from different sources:');
            sources.forEach((source, index) => {
                try {
                    const lang = source();
                    console.log(`  Source ${index + 1}: ${lang}`);
                } catch (error) {
                    console.log(`  Source ${index + 1}: Error - ${error.message}`);
                }
            });
        }
        
        function updateCurrentLanguage() {
            const currentLangElement = document.getElementById('currentLanguage');
            
            // Try to get current language from various sources
            let currentLang = 'Unknown';
            
            if (window.StakeOutAI) {
                currentLang = StakeOutAI.getCurrentLanguage();
            } else if (window.LanguageBridge) {
                currentLang = window.LanguageBridge.getCurrentLanguage();
            } else if (window.LanguageManager) {
                currentLang = window.LanguageManager.getCurrentLanguage();
            } else if (UIBridge.getLanguage) {
                currentLang = UIBridge.getLanguage();
            } else {
                currentLang = App.I18n.locale;
            }
            
            currentLangElement.textContent = currentLang;
        }
        
        function updateTranslationDemo() {
            const keys = ['stakeout.zoom_in', 'stakeout.zoom_out', 'stakeout.auto_zoom'];
            
            keys.forEach(key => {
                const element = document.getElementById('trans_' + key.split('.')[1]);
                if (element) {
                    let translation = key;
                    
                    // Try to get translation
                    if (window.StakeOutUIEnhanced) {
                        const ui = new window.StakeOutUIEnhanced();
                        translation = ui.getTranslation(key, key);
                    } else if (App.I18n && App.I18n.t) {
                        translation = App.I18n.t(key);
                    }
                    
                    element.textContent = translation;
                }
            });
        }
        
        function updateSystemStatus() {
            const statusElement = document.getElementById('systemStatus');
            
            const status = {
                stakeOutAI: !!window.StakeOutAI,
                languageManager: !!window.LanguageManager,
                languageIntegration: !!window.LanguageIntegration,
                languageBridge: !!window.LanguageBridge,
                enhancedUI: !!window.StakeOutUIEnhanced,
                appI18n: !!(typeof App !== 'undefined' && App.I18n),
                uiBridge: !!window.UIBridge
            };
            
            let statusText = 'System Status:\n';
            Object.entries(status).forEach(([key, value]) => {
                const icon = value ? '‚úÖ' : '‚ùå';
                statusText += `${icon} ${key}: ${value ? 'Available' : 'Not Available'}\n`;
            });
            
            // Add detailed status if available
            if (window.StakeOutAI) {
                try {
                    const detailedStatus = StakeOutAI.getLanguageStatus();
                    statusText += '\nDetailed Status:\n';
                    statusText += JSON.stringify(detailedStatus, null, 2);
                } catch (error) {
                    statusText += '\nDetailed Status: Error - ' + error.message;
                }
            }
            
            statusElement.textContent = statusText;
        }
        
        function clearOutput() {
            document.getElementById('consoleOutput').textContent = '';
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ StakeOut AI Language Test Page Loaded');
            
            // Wait for systems to initialize
            setTimeout(() => {
                updateCurrentLanguage();
                updateTranslationDemo();
                updateSystemStatus();
                
                // Initialize language systems
                if (window.LanguageManager) {
                    window.LanguageManager.initialize();
                }
                if (window.LanguageIntegration) {
                    window.LanguageIntegration.initializeIntegration();
                }
                
                console.log('‚úÖ All systems initialized');
            }, 1000);
        });
        
        // Update current language display periodically
        setInterval(updateCurrentLanguage, 5000);
    </script>
</body>
</html>